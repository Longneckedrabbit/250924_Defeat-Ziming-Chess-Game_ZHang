<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è±¡æ£‹AIå­¦ä¹ ç³»ç»Ÿ - å¯¹æˆ˜å¼ å­é¸£</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }

        .game-area {
            display: flex;
            padding: 20px;
            gap: 20px;
        }

        .board-container {
            flex: 2;
        }

        .chess-board {
            width: 100%;
            max-width: 600px;
            height: 660px;
            background: #f4d03f;
            border: 3px solid #8b4513;
            position: relative;
            margin: 0 auto;
        }

        .board-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(10, 1fr);
        }

        .board-cell {
            border: 1px solid #8b4513;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
        }

        .board-cell:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .board-cell.selected {
            background-color: rgba(0, 255, 0, 0.5);
        }

        .board-cell.possible-move {
            background-color: rgba(0, 0, 255, 0.3);
        }

        .chess-piece {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid;
            transition: all 0.3s ease;
        }

        .chess-piece.red {
            background: #ff4444;
            color: white;
            border-color: #cc0000;
        }

        .chess-piece.black {
            background: #333;
            color: white;
            border-color: #000;
        }

        .chess-piece:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }

        .info-panel {
            flex: 1;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .game-status {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .game-status h3 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }

        .ai-status {
            background: #f3e5f5;
            border: 1px solid #9c27b0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .ai-status h3 {
            margin: 0 0 10px 0;
            color: #7b1fa2;
        }

        .learning-stats {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
        }

        .learning-stats h3 {
            margin: 0 0 10px 0;
            color: #2e7d32;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn.secondary {
            background: linear-gradient(45deg, #ff9800, #f57c00);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            transition: width 0.3s ease;
        }

        .progress-tracking {
            background: #f0f8ff;
            border: 1px solid #4169e1;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .progress-overview {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .progress-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            position: relative;
            overflow: hidden;
        }

        .progress-circle::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: #4CAF50;
            clip-path: polygon(50% 50%, 50% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, 50% 0%);
            transform: rotate(var(--progress));
            transform-origin: center;
        }

        .progress-circle::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: white;
        }

        .progress-text {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .progress-number {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }

        .progress-label {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .progress-details {
            flex: 1;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
        }

        .detail-label {
            color: #666;
            font-size: 14px;
        }

        .detail-value {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .milestones {
            background: #fff8dc;
            border: 1px solid #daa520;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .milestone-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .milestone-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            border-radius: 5px;
            background: #f9f9f9;
        }

        .milestone-item.achieved {
            background: #e8f5e8;
            border-left: 4px solid #4CAF50;
        }

        .milestone-item.pending {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .milestone-icon {
            margin-right: 10px;
            font-size: 18px;
        }

        .milestone-content {
            flex: 1;
        }

        .milestone-name {
            font-weight: bold;
            color: #333;
        }

        .milestone-desc {
            font-size: 12px;
            color: #666;
            margin-top: 2px;
        }

        .milestone-progress {
            font-size: 12px;
            color: #4CAF50;
            font-weight: bold;
        }

        .skill-chart {
            background: #f0f8ff;
            border: 1px solid #4169e1;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .skill-chart canvas {
            width: 100%;
            height: 200px;
        }

        .progress-actions {
            text-align: center;
            margin-top: 15px;
        }

        .progress-actions button {
            margin: 0 5px;
            padding: 8px 16px;
            font-size: 14px;
        }

        .ai-thinking {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #666;
        }

        .river {
            position: absolute;
            left: 0;
            right: 0;
            top: 50%;
            height: 2px;
            background: #8b4513;
            transform: translateY(-50%);
        }

        .river-text {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: #f4d03f;
            padding: 0 10px;
            font-size: 18px;
            font-weight: bold;
            color: #8b4513;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ´ è±¡æ£‹AIå­¦ä¹ ç³»ç»Ÿ</h1>
            <p>ä¸“é—¨å­¦ä¹ å¼ å­é¸£æ£‹é£çš„æ™ºèƒ½è±¡æ£‹å¯¹æ‰‹</p>
        </div>

        <div class="game-area">
            <div class="board-container">
                <div class="chess-board" id="chessBoard">
                    <div class="river">
                        <div class="river-text">æ¥šæ²³æ±‰ç•Œ</div>
                    </div>
                    <div class="board-grid" id="boardGrid">
                        <!-- æ£‹ç›˜æ ¼å­å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                    </div>
                </div>

                <div class="controls">
                    <button class="btn" onclick="startNewGame()">æ–°æ¸¸æˆ</button>
                    <button class="btn secondary" onclick="showLearningProgress()">å­¦ä¹ è¿›åº¦</button>
                    <button class="btn secondary" onclick="showGameHistory()">å¯¹å±€å†å²</button>
                </div>
            </div>

            <div class="info-panel">
                <div class="game-status">
                    <h3>ğŸ® æ¸¸æˆçŠ¶æ€</h3>
                    <div id="currentPlayer">å½“å‰ç©å®¶: çº¢æ–¹ (æ‚¨)</div>
                    <div id="gameState">æ¸¸æˆçŠ¶æ€: è¿›è¡Œä¸­</div>
                    <div id="moveCount">å›åˆæ•°: 0</div>
                </div>

                <div class="ai-status">
                    <h3>ğŸ¤– AIçŠ¶æ€</h3>
                    <div id="aiLevel">AIç­‰çº§: å°ç™½</div>
                    <div id="aiThinking" class="ai-thinking" style="display: none;">
                        AIæ­£åœ¨æ€è€ƒä¸­...
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="aiProgress" style="width: 10%"></div>
                    </div>
                    <div id="aiLearning">å­¦ä¹ çŠ¶æ€: åˆå§‹é˜¶æ®µ</div>
                </div>

                <div class="learning-stats">
                    <h3>ğŸ“Š å­¦ä¹ ç»Ÿè®¡</h3>
                    <div class="stat-item">
                        <span>æ€»å¯¹å±€æ•°:</span>
                        <span id="totalGames">0</span>
                    </div>
                    <div class="stat-item">
                        <span>AIèƒœåˆ©:</span>
                        <span id="aiWins">0</span>
                    </div>
                    <div class="stat-item">
                        <span>å¼ å­é¸£èƒœåˆ©:</span>
                        <span id="humanWins">0</span>
                    </div>
                    <div class="stat-item">
                        <span>å¹³å±€:</span>
                        <span id="draws">0</span>
                    </div>
                    <div class="stat-item">
                        <span>å­¦ä¹ æ¨¡å¼:</span>
                        <span id="patternsLearned">0</span>
                    </div>
                    <div class="stat-item">
                        <span>èƒœç‡:</span>
                        <span id="winRate">0%</span>
                    </div>
                </div>

                <div class="progress-tracking">
                    <h3>ğŸ“ˆ å­¦ä¹ è¿›åº¦è¿½è¸ª</h3>
                    <div class="progress-overview">
                        <div class="progress-circle" id="skillProgress">
                            <div class="progress-text">
                                <div class="progress-number">0%</div>
                                <div class="progress-label">æ€»ä½“è¿›åº¦</div>
                            </div>
                        </div>
                        <div class="progress-details">
                            <div class="detail-item">
                                <span class="detail-label">å½“å‰æ®µä½:</span>
                                <span class="detail-value" id="currentRank">å°ç™½</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">æŠ€èƒ½ç­‰çº§:</span>
                                <span class="detail-value" id="skillLevel">0</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">è¿ç»­å­¦ä¹ :</span>
                                <span class="detail-value" id="learningStreak">0å¤©</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">é¢„è®¡å®Œæˆ:</span>
                                <span class="detail-value" id="estimatedCompletion">æ— æ³•ä¼°è®¡</span>
                            </div>
                        </div>
                    </div>

                    <div class="milestones">
                        <h4>ğŸ† å­¦ä¹ é‡Œç¨‹ç¢‘</h4>
                        <div class="milestone-list" id="milestoneList">
                            <!-- é‡Œç¨‹ç¢‘å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </div>
                    </div>

                    <div class="skill-chart">
                        <h4>ğŸ“Š æŠ€èƒ½è¿›æ­¥å›¾è¡¨</h4>
                        <canvas id="skillChart" width="300" height="200"></canvas>
                    </div>

                    <div class="progress-actions">
                        <button class="btn secondary" onclick="showDetailedProgress()">è¯¦ç»†è¿›åº¦</button>
                        <button class="btn secondary" onclick="showProgressReport()">è¿›åº¦æŠ¥å‘Š</button>
                        <button class="btn secondary" onclick="exportProgressData()">å¯¼å‡ºæ•°æ®</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            board: Array(10).fill(null).map(() => Array(9).fill(null)),
            currentPlayer: 'red',
            selectedCell: null,
            gameActive: true,
            moveHistory: []
        };

        // æ£‹å­Unicodeç¬¦å·
        const pieceSymbols = {
            red: {
                king: 'å¸…',
                advisor: 'ä»•',
                elephant: 'ç›¸',
                horse: 'é©¬',
                rook: 'è½¦',
                cannon: 'ç‚®',
                pawn: 'å…µ'
            },
            black: {
                king: 'å°†',
                advisor: 'å£«',
                elephant: 'è±¡',
                horse: 'é©¬',
                rook: 'è½¦',
                cannon: 'ç‚®',
                pawn: 'å’'
            }
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initializeGame() {
            createBoard();
            initializeChessPieces(); // åˆå§‹åŒ–æ£‹å­
            updateGameStatus();
            fetchLearningStats();
        }

        // åˆ›å»ºæ£‹ç›˜
        function createBoard() {
            const boardGrid = document.getElementById('boardGrid');
            boardGrid.innerHTML = '';

            for (let row = 0; row < 10; row++) {
                for (let col = 0; col < 9; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'board-cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    cell.onclick = () => cellClicked(row, col);
                    boardGrid.appendChild(cell);
                }
            }
        }

        // å¤„ç†å•å…ƒæ ¼ç‚¹å‡»
        function cellClicked(row, col) {
            if (!gameState.gameActive) return;

            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);

            if (gameState.selectedCell) {
                // å°è¯•ç§»åŠ¨
                if (isValidMove(gameState.selectedCell, {row, col})) {
                    makeMove(gameState.selectedCell, {row, col});
                }
                clearSelection();
            } else {
                // é€‰æ‹©æ£‹å­
                if (hasPiece(row, col)) {
                    selectCell(row, col);
                }
            }
        }

        // é€‰æ‹©å•å…ƒæ ¼
        function selectCell(row, col) {
            clearSelection();
            gameState.selectedCell = {row, col};
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            cell.classList.add('selected');
        }

        // æ¸…é™¤é€‰æ‹©
        function clearSelection() {
            document.querySelectorAll('.board-cell').forEach(cell => {
                cell.classList.remove('selected', 'possible-move');
            });
            gameState.selectedCell = null;
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰æ£‹å­
        function hasPiece(row, col) {
            if (row >= 0 && row < 10 && col >= 0 && col < 9) {
                const piece = gameState.board[row][col];
                return piece !== null && piece !== undefined;
            }
            return false;
        }

        // éªŒè¯ç§»åŠ¨æ˜¯å¦åˆæ³•
        function isValidMove(from, to) {
            // è¿™é‡Œéœ€è¦å®ç°è±¡æ£‹è§„åˆ™
            return true; // ä¸´æ—¶è¿”å›
        }

        // æ‰§è¡Œç§»åŠ¨
        function makeMove(from, to) {
            const moveData = {
                from: {row: from.row, col: from.col},
                to: {row: to.row, col: to.col},
                player: gameState.currentPlayer
            };

            // å‘é€åˆ°åç«¯
            fetch('/api/game/move', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    from: `${from.row},${from.col}`,
                    to: `${to.row},${to.col}`
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    updateBoard(data.game_state);
                    if (data.ai_move) {
                        showAIMove(data.ai_move);
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });

            gameState.moveHistory.push(moveData);
            gameState.currentPlayer = gameState.currentPlayer === 'red' ? 'black' : 'red';
            updateGameStatus();
        }

        // æ˜¾ç¤ºAIç§»åŠ¨
        function showAIMove(aiMove) {
            document.getElementById('aiThinking').style.display = 'block';
            setTimeout(() => {
                document.getElementById('aiThinking').style.display = 'none';
                updateBoard(aiMove);
            }, 1000);
        }

        // æ›´æ–°æ£‹ç›˜æ˜¾ç¤º
        function updateBoard(gameStateData) {
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            gameState.board = gameStateData.board;
            gameState.currentPlayer = gameStateData.current_player;
            gameState.gameActive = gameStateData.game_state === 'playing';

            // æ¸…é™¤æ‰€æœ‰æ£‹å­
            document.querySelectorAll('.chess-piece').forEach(piece => piece.remove());

            // é‡æ–°æ¸²æŸ“æ£‹å­
            for (let row = 0; row < 10; row++) {
                for (let col = 0; col < 9; col++) {
                    const piece = gameState.board[row][col];
                    if (piece) {
                        const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                        if (cell) {
                            const pieceElement = document.createElement('div');
                            pieceElement.className = `chess-piece ${piece.color}`;
                            pieceElement.textContent = pieceSymbols[piece.color][piece.type];
                            pieceElement.dataset.row = row;
                            pieceElement.dataset.col = col;
                            cell.appendChild(pieceElement);
                        }
                    }
                }
            }

            updateGameStatus();
        }

        // åˆå§‹åŒ–æ£‹ç›˜ï¼ˆæ˜¾ç¤ºåˆå§‹æ£‹å­å¸ƒå±€ï¼‰
        function initializeChessPieces() {
            // çº¢æ–¹æ£‹å­ï¼ˆä¸‹æ–¹ï¼‰
            // è½¦
            placePiece(9, 0, 'red', 'rook');
            placePiece(9, 8, 'red', 'rook');
            // é©¬
            placePiece(9, 1, 'red', 'horse');
            placePiece(9, 7, 'red', 'horse');
            // ç›¸
            placePiece(9, 2, 'red', 'elephant');
            placePiece(9, 6, 'red', 'elephant');
            // å£«
            placePiece(9, 3, 'red', 'advisor');
            placePiece(9, 5, 'red', 'advisor');
            // å¸…
            placePiece(9, 4, 'red', 'king');
            // ç‚®
            placePiece(7, 1, 'red', 'cannon');
            placePiece(7, 7, 'red', 'cannon');
            // å…µ
            for (let i = 0; i < 9; i += 2) {
                placePiece(6, i, 'red', 'pawn');
            }

            // é»‘æ–¹æ£‹å­ï¼ˆä¸Šæ–¹ï¼‰
            // è½¦
            placePiece(0, 0, 'black', 'rook');
            placePiece(0, 8, 'black', 'rook');
            // é©¬
            placePiece(0, 1, 'black', 'horse');
            placePiece(0, 7, 'black', 'horse');
            // è±¡
            placePiece(0, 2, 'black', 'elephant');
            placePiece(0, 6, 'black', 'elephant');
            // å£«
            placePiece(0, 3, 'black', 'advisor');
            placePiece(0, 5, 'black', 'advisor');
            // å°†
            placePiece(0, 4, 'black', 'king');
            // ç‚®
            placePiece(2, 1, 'black', 'cannon');
            placePiece(2, 7, 'black', 'cannon');
            // å’
            for (let i = 0; i < 9; i += 2) {
                placePiece(3, i, 'black', 'pawn');
            }
        }

        // æ”¾ç½®æ£‹å­
        function placePiece(row, col, color, type) {
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            if (cell) {
                const pieceElement = document.createElement('div');
                pieceElement.className = `chess-piece ${color}`;
                pieceElement.textContent = pieceSymbols[color][type];
                pieceElement.dataset.row = row;
                pieceElement.dataset.col = col;
                cell.appendChild(pieceElement);

                // æ›´æ–°æ¸¸æˆçŠ¶æ€
                if (!gameState.board[row]) {
                    gameState.board[row] = Array(9).fill(null);
                }
                gameState.board[row][col] = {type: type, color: color};
            }
        }

        // æ›´æ–°æ¸¸æˆçŠ¶æ€æ˜¾ç¤º
        function updateGameStatus() {
            document.getElementById('currentPlayer').textContent =
                `å½“å‰ç©å®¶: ${gameState.currentPlayer === 'red' ? 'çº¢æ–¹ (æ‚¨)' : 'é»‘æ–¹ (AI)'}`;
            document.getElementById('gameState').textContent =
                `æ¸¸æˆçŠ¶æ€: ${gameState.gameActive ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ'}`;
            document.getElementById('moveCount').textContent =
                `å›åˆæ•°: ${gameState.moveHistory.length}`;
        }

        // å¼€å§‹æ–°æ¸¸æˆ
        function startNewGame() {
            fetch('/api/game/start', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    updateBoard(data.game_state);
                    clearSelection();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        // è·å–å­¦ä¹ ç»Ÿè®¡
        function fetchLearningStats() {
            fetch('/api/learning/stats')
            .then(response => response.json())
            .then(data => {
                document.getElementById('totalGames').textContent = data.games_played;
                document.getElementById('aiWins').textContent = data.wins;
                document.getElementById('humanWins').textContent = data.losses;
                document.getElementById('draws').textContent = data.draws;
                document.getElementById('patternsLearned').textContent = data.patterns_learned;

                const totalGames = data.games_played;
                const winRate = totalGames > 0 ? ((data.wins / totalGames) * 100).toFixed(1) : 0;
                document.getElementById('winRate').textContent = `${winRate}%`;

                // æ›´æ–°AIè¿›åº¦æ¡
                const progress = Math.min((totalGames / 100) * 100, 100);
                document.getElementById('aiProgress').style.width = `${progress}%`;

                // æ›´æ–°AIç­‰çº§
                let aiLevel = 'å°ç™½';
                if (totalGames > 50) aiLevel = 'åˆå­¦è€…';
                if (totalGames > 100) aiLevel = 'ä¸šä½™';
                if (totalGames > 200) aiLevel = 'ä¸­çº§';
                if (totalGames > 500) aiLevel = 'é«˜çº§';
                if (totalGames > 1000) aiLevel = 'å¤§å¸ˆ';

                document.getElementById('aiLevel').textContent = `AIç­‰çº§: ${aiLevel}`;
            })
            .catch(error => {
                console.error('Error:', error);
            });

            // è·å–è¿›åº¦è¿½è¸ªæ•°æ®
            fetchProgressData();
        }

        // è·å–è¿›åº¦è¿½è¸ªæ•°æ®
        function fetchProgressData() {
            // è·å–è¿›åº¦æ€»ç»“
            fetch('/api/progress/summary')
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    updateProgressSummary(data.summary);
                }
            })
            .catch(error => {
                console.error('è·å–è¿›åº¦æ€»ç»“å¤±è´¥:', error);
            });

            // è·å–é‡Œç¨‹ç¢‘æ•°æ®
            fetch('/api/progress/milestones')
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    updateMilestones(data.milestones);
                }
            })
            .catch(error => {
                console.error('è·å–é‡Œç¨‹ç¢‘å¤±è´¥:', error);
            });

            // è·å–å›¾è¡¨æ•°æ®
            fetch('/api/progress/chart-data')
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    updateChart(data.chart_data);
                }
            })
            .catch(error => {
                console.error('è·å–å›¾è¡¨æ•°æ®å¤±è´¥:', error);
            });
        }

        // æ›´æ–°è¿›åº¦æ€»ç»“
        function updateProgressSummary(summary) {
            // æ›´æ–°è¿›åº¦åœ†ç¯
            const progressCircle = document.getElementById('skillProgress');
            const progressPercent = summary.overall_progress;
            progressCircle.style.setProperty('--progress', `${progressPercent * 3.6}deg`);
            document.querySelector('.progress-number').textContent = `${Math.round(progressPercent)}%`;

            // æ›´æ–°è¯¦ç»†ä¿¡æ¯
            document.getElementById('currentRank').textContent = summary.skill_rank;
            document.getElementById('skillLevel').textContent = Math.round(summary.skill_level);
            document.getElementById('learningStreak').textContent = `${summary.learning_streak}å¤©`;
            document.getElementById('estimatedCompletion').textContent = summary.estimated_completion;
        }

        // æ›´æ–°é‡Œç¨‹ç¢‘
        function updateMilestones(milestones) {
            const milestoneList = document.getElementById('milestoneList');
            milestoneList.innerHTML = '';

            // åªæ˜¾ç¤ºæœ€è¿‘çš„5ä¸ªé‡Œç¨‹ç¢‘
            const recentMilestones = milestones.slice(0, 5);

            recentMilestones.forEach(milestone => {
                const milestoneItem = document.createElement('div');
                milestoneItem.className = `milestone-item ${milestone.achieved ? 'achieved' : 'pending'}`;

                const icon = milestone.achieved ? 'ğŸ†' : 'â³';
                const status = milestone.achieved ? 'å·²è¾¾æˆ' : 'è¿›è¡Œä¸­';

                milestoneItem.innerHTML = `
                    <div class="milestone-icon">${icon}</div>
                    <div class="milestone-content">
                        <div class="milestone-name">${milestone.name}</div>
                        <div class="milestone-desc">${milestone.description}</div>
                    </div>
                    <div class="milestone-progress">${status}</div>
                `;

                milestoneList.appendChild(milestoneItem);
            });
        }

        // æ›´æ–°å›¾è¡¨
        function updateChart(chartData) {
            // è¿™é‡Œå¯ä»¥ä½¿ç”¨Chart.jsæˆ–å…¶ä»–å›¾è¡¨åº“æ¥æ˜¾ç¤ºæ•°æ®
            // ç®€åŒ–å®ç°ï¼Œåªæ›´æ–°ä¸€äº›åŸºæœ¬æ•°æ®
            console.log('å›¾è¡¨æ•°æ®:', chartData);
        }

        // æ˜¾ç¤ºè¯¦ç»†è¿›åº¦
        function showDetailedProgress() {
            alert('è¯¦ç»†è¿›åº¦åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        // æ˜¾ç¤ºè¿›åº¦æŠ¥å‘Š
        function showProgressReport() {
            fetch('/api/progress/report')
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert(data.report);
                }
            })
            .catch(error => {
                console.error('è·å–è¿›åº¦æŠ¥å‘Šå¤±è´¥:', error);
                alert('è·å–è¿›åº¦æŠ¥å‘Šå¤±è´¥');
            });
        }

        // å¯¼å‡ºè¿›åº¦æ•°æ®
        function exportProgressData() {
            alert('å¯¼å‡ºæ•°æ®åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        // æ˜¾ç¤ºå­¦ä¹ è¿›åº¦
        function showLearningProgress() {
            alert('å­¦ä¹ è¿›åº¦åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        // æ˜¾ç¤ºå¯¹å±€å†å²
        function showGameHistory() {
            alert('å¯¹å±€å†å²åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ¸¸æˆ
        window.onload = initializeGame;
    </script>
</body>
</html>